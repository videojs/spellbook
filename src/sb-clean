#!/usr/bin/env node
var config = require('./utils/get-config')();
var shelljs = require('shelljs');
var path = require('path');
var log = require('./utils/log');
var CommanderWrapper = require('./utils/commander-wrapper');
var GetFiles = require('./utils/get-files');

var program = CommanderWrapper(function(commander) {
  return commander
    .option('-d, --dry-run', 'see what would happen when you run clean')
    .option('-c, --cache', 'clear the  cache folder too');
});

if (program.quiet && program.dryRun) {
  log.fatal('--dry-run should not be used with --quiet');
  process.exit(1);
}

var fileSearches = [
  path.join(config.path, '**',  'npm-debug.log'),
  config.dist
];

if (program.cache) {
  fileSearches.push(config.cache);
}

GetFiles(fileSearches).forEach(function(file) {
  if (!program.quiet) {
    log.info('removing ' + file);
  }
  if (!program.dryRun) {
    shelljs.rm('-rf', file);
  }
});
